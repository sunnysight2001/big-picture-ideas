<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ idea.title }} ‚Äì Big Picture Ideas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Idea page styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/idea.css') }}">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>

<body class="idea-page">

  <!-- Reading progress bar -->
  <div class="progress-bar" id="progressBar"></div>

  <div class="idea-page-bg">

    <div class="container">

      <!-- Enhanced Navigation Header -->
      <nav class="nav-header">
        <a href="/" class="back-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Home
        </a>
      </nav>

      <article class="idea-card">

        <!-- HEADER -->
        <div class="idea-header">
          <h1>{{ idea.title }}</h1>
          <p class="idea-subtitle">{{ idea.subtitle }}</p>
        </div>

        <!-- OPENING -->
        <section class="idea-opening">
          {% for paragraph in idea.opening.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>

        <!-- ESSENCE -->
        <section class="idea-essence">
          <strong>{{ idea.essence }}</strong>
        </section>

        <!-- VISUAL -->
        {% if idea.visual_image %}
        <section class="idea-visual">
          <img
            src="{{ url_for('static', filename='images/ideas/' + idea.visual_image) }}"
            alt="{{ idea.title }}"
            loading="lazy"
          >
          <p class="visual-caption">{{ idea.visual_caption }}</p>
        </section>
        {% endif %}

        <!-- EXPLANATION -->
        <section class="idea-explanation">
          {% for paragraph in idea.explanation.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>

        <!-- STEPS -->
        {% if idea.steps %}
        <section class="idea-steps">
          <h3>The Mental Model</h3>
          <ol>
            {% for step in idea.steps %}
              <li>
                <strong>{{ step.title }}</strong><br>
                {{ step.description }}
              </li>
            {% endfor %}
          </ol>
        </section>
        {% endif %}

        <!-- EXAMPLE -->
        {% if idea.example %}
        <section class="idea-example">
          <h3>A Worked Example</h3>
          {% for paragraph in idea.example.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>
        {% endif %}

        <!-- APPLY -->
        {% if idea.when_to_apply %}
        <section class="idea-apply">
          <h3>When to Apply</h3>
          <ul>
            {% for item in idea.when_to_apply %}
              <li>{{ item }}</li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        <!-- AVOID -->
        {% if idea.when_not_to_apply %}
        <section class="idea-avoid">
          <h3>When Not to Apply</h3>
          <ul>
            {% for item in idea.when_not_to_apply %}
              <li>{{ item }}</li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        <!-- PRACTICE -->
        {% if idea.practice %}
        <section class="idea-practice">
          <h3>Try This Once</h3>
          <p>{{ idea.practice }}</p>
        </section>
        {% endif %}

        <!-- META -->
        <div class="idea-meta">
          <div class="meta-left">
            <span>üëÅ <span id="view-count">{{ idea.views | default(0) }}</span></span>
            <span>‚ù§Ô∏è <span id="like-count">{{ idea.likes | default(0) }}</span></span>
          </div>
          <div class="meta-right">
            <button class="meta-btn" id="like-btn" onclick="likeIdea('{{ idea.id }}')">Like</button>
            <button class="meta-btn" id="share-btn" onclick="shareIdea('{{ idea.id }}')">Share</button>
          </div>
        </div>

        <!-- NEXT IDEA NAVIGATION -->
        {% if next_idea %}
        <a href="/idea/{{ next_idea.id }}" class="next-idea-nav">
          <div>
            <div class="next-idea-label">Next Idea</div>
            <h4 class="next-idea-title">{{ next_idea.title }}</h4>
          </div>
          <div class="next-idea-link">
            Continue
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </div>
        </a>
        {% endif %}

        <!-- NEWSLETTER -->
        <section class="idea-newsletter">
          <h3>One powerful idea every week</h3>
          <p class="muted">No noise. No spam. Just clarity.</p>

          <form class="newsletter-form" action="/subscribe" method="POST">
            <input type="email" name="email" placeholder="Your email address" required>
            <button type="submit">Subscribe</button>
          </form>
        </section>

      </article>

    </div>
  </div>

  <!-- Reading Progress Script -->
  <script>
    // Reading progress bar
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height);
      document.getElementById('progressBar').style.transform = `scaleX(${scrolled})`;
    });

    // Like button functionality
    function likeIdea(ideaId) {
      const likeBtn = document.getElementById('like-btn');
      const likeCount = document.getElementById('like-count');
      
      // Disable button temporarily
      likeBtn.disabled = true;
      likeBtn.textContent = 'Liking...';
      
      fetch(`/api/like/${ideaId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          likeCount.textContent = data.likes;
          likeBtn.textContent = 'Liked! ‚ù§Ô∏è';
          likeBtn.style.background = '#10b981';
          likeBtn.style.color = 'white';
          likeBtn.style.borderColor = '#10b981';
          
          // Re-enable after 2 seconds
          setTimeout(() => {
            likeBtn.disabled = false;
            likeBtn.textContent = 'Like';
          }, 2000);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        likeBtn.disabled = false;
        likeBtn.textContent = 'Like';
      });
    }

    // Share button functionality
    function shareIdea(ideaId) {
      const shareBtn = document.getElementById('share-btn');
      const currentUrl = window.location.href;
      
      // Try native share API first (mobile)
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: currentUrl
        })
        .then(() => {
          // Track share
          fetch(`/api/share/${ideaId}`, { method: 'POST' });
          shareBtn.textContent = 'Shared! ‚úì';
          shareBtn.style.background = '#10b981';
          shareBtn.style.color = 'white';
          
          setTimeout(() => {
            shareBtn.textContent = 'Share';
            shareBtn.style.background = '#f3f4f6';
            shareBtn.style.color = 'inherit';
          }, 2000);
        })
        .catch(err => console.log('Share cancelled'));
      } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(currentUrl)
        .then(() => {
          // Track share
          fetch(`/api/share/${ideaId}`, { method: 'POST' });
          shareBtn.textContent = 'Link Copied! ‚úì';
          shareBtn.style.background = '#10b981';
          shareBtn.style.color = 'white';
          
          setTimeout(() => {
            shareBtn.textContent = 'Share';
            shareBtn.style.background = '#f3f4f6';
            shareBtn.style.color = 'inherit';
          }, 2000);
        })
        .catch(err => {
          alert('Could not copy link. Please copy manually: ' + currentUrl);
        });
      }
    }
  </script>

</body>
</html>