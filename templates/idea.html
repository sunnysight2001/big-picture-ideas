<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ idea.title }} – Big Picture Ideas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Idea page styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/idea.css') }}">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
</head>

<body class="idea-page">

  <!-- Reading progress bar -->
  <div class="progress-bar" id="progressBar"></div>

  <div class="idea-page-bg">

    <div class="container">

      <!-- Enhanced Navigation Header -->
      <nav class="nav-header">
        <a href="/" class="back-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          Back to Home
        </a>
      </nav>

      <article class="idea-card">

        <!-- HEADER -->
        <div class="idea-header">
          <h1>{{ idea.title }}</h1>
          <p class="idea-subtitle">{{ idea.subtitle }}</p>
        </div>

        <!-- OPENING -->
        <section class="idea-opening">
          {% for paragraph in idea.opening.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>

        <!-- ESSENCE -->
        <section class="idea-essence">
          <strong>{{ idea.essence }}</strong>
        </section>

        <!-- VISUAL -->
        {% if idea.visual_image %}
        <section class="idea-visual">
          <img
            src="{{ url_for('static', filename='images/ideas/' + idea.visual_image) }}"
            alt="{{ idea.title }}"
            loading="lazy"
          >
          <p class="visual-caption">{{ idea.visual_caption }}</p>
        </section>
        {% endif %}

        <!-- EXPLANATION -->
        <section class="idea-explanation">
          {% for paragraph in idea.explanation.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>

        <!-- STEPS -->
        {% if idea.steps %}
        <section class="idea-steps">
          <h3>The Mental Model</h3>
          <ol>
            {% for step in idea.steps %}
              <li>
                <strong>{{ step.title }}</strong><br>
                {{ step.description }}
              </li>
            {% endfor %}
          </ol>
        </section>
        {% endif %}

        <!-- EXAMPLE -->
        {% if idea.example %}
        <section class="idea-example">
          <h3>A Worked Example</h3>
          {% for paragraph in idea.example.split('\n') %}
            {% if paragraph.strip() %}
              <p>{{ paragraph }}</p>
            {% endif %}
          {% endfor %}
        </section>
        {% endif %}

        <!-- APPLY -->
        {% if idea.when_to_apply %}
        <section class="idea-apply">
          <h3>When to Apply</h3>
          <ul>
            {% for item in idea.when_to_apply %}
              <li>{{ item }}</li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        <!-- AVOID -->
        {% if idea.when_not_to_apply %}
        <section class="idea-avoid">
          <h3>When Not to Apply</h3>
          <ul>
            {% for item in idea.when_not_to_apply %}
              <li>{{ item }}</li>
            {% endfor %}
          </ul>
        </section>
        {% endif %}

        <!-- PRACTICE -->
        {% if idea.practice %}
        <section class="idea-practice">
          <h3>Try This Once</h3>
          <p>{{ idea.practice }}</p>
        </section>
        {% endif %}

        <!-- VIDEO (NEW) -->
        {% if idea.video %}
        <section class="idea-video" style="margin: 56px 0;">
          <h3 style="text-align: center; margin-bottom: 24px; font-size: 1.5rem;">Watch: {{ idea.title }}</h3>
          <div class="video-container" style="position: relative; width: 100%; max-width: 900px; margin: 0 auto; padding-bottom: 50.625%; height: 0; overflow: hidden; border-radius: 14px; box-shadow: 0 18px 40px rgba(0,0,0,0.12); background: #000;">
            {% if idea.video.startswith('http') %}
              <!-- External video (YouTube, Vimeo, etc.) -->
              <iframe 
                src="{{ idea.video }}" 
                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 14px;"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen
                loading="lazy">
              </iframe>
            {% else %}
              <!-- Local video file -->
              <video controls preload="metadata" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 14px; background: #000;">
                <source src="{{ url_for('static', filename='videos/' + idea.video) }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            {% endif %}
          </div>
          {% if idea.video_caption %}
          <p class="video-caption" style="font-size: 0.9rem; color: #6b7280; margin-top: 16px; text-align: center; font-style: italic; max-width: 900px; margin-left: auto; margin-right: auto;">{{ idea.video_caption }}</p>
          {% endif %}
        </section>
        {% endif %}

        <!-- META -->
        <div class="idea-meta">
          <div class="meta-left">
            
          </div>
          <div class="meta-right">
             <button class="meta-btn" id="share-btn" onclick="shareIdea('{{ idea.id }}')">Share</button>
          </div>
        </div>

        <!-- NEXT IDEA NAVIGATION -->
        {% if next_idea %}
        <a href="/idea/{{ next_idea.id }}" class="next-idea-nav">
          <div>
            <div class="next-idea-label">Next Idea</div>
            <h4 class="next-idea-title">{{ next_idea.title }}</h4>
          </div>
          <div class="next-idea-link">
            Continue
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </div>
        </a>
        {% endif %}

        <!-- NEWSLETTER -->
        <section class="idea-newsletter">
          <h3>One powerful idea every week</h3>
          <p class="muted">No noise. No spam. Just clarity.</p>

          <form class="newsletter-form" action="/subscribe" method="POST">
            <input type="email" name="email" placeholder="Your email address" required>
            <button type="submit">Subscribe</button>
          </form>
        </section>

      </article>

    </div>
  </div>

  <!-- Reading Progress Script -->
  <script>
    // Reading progress bar
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height);
      document.getElementById('progressBar').style.transform = `scaleX(${scrolled})`;
    });

    
    // Share button functionality
    function shareIdea(ideaId) {
      const shareBtn = document.getElementById('share-btn');
      const currentUrl = window.location.href;
      
      // Try native share API first (mobile)
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: currentUrl
        })
        .then(() => {
          // Track share
          fetch(`/api/share/${ideaId}`, { method: 'POST' });
          shareBtn.textContent = 'Shared! ✓';
          shareBtn.style.background = '#10b981';
          shareBtn.style.color = 'white';
          
          setTimeout(() => {
            shareBtn.textContent = 'Share';
            shareBtn.style.background = '#f3f4f6';
            shareBtn.style.color = 'inherit';
          }, 2000);
        })
        .catch(err => console.log('Share cancelled'));
      } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(currentUrl)
        .then(() => {
          // Track share
          fetch(`/api/share/${ideaId}`, { method: 'POST' });
          shareBtn.textContent = 'Link Copied! ✓';
          shareBtn.style.background = '#10b981';
          shareBtn.style.color = 'white';
          
          setTimeout(() => {
            shareBtn.textContent = 'Share';
            shareBtn.style.background = '#f3f4f6';
            shareBtn.style.color = 'inherit';
          }, 2000);
        })
        .catch(err => {
          alert('Could not copy link. Please copy manually: ' + currentUrl);
        });
      }
    }
  </script>

</body>
</html>